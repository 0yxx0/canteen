<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>源辰-菜品类型管理</title>
<link rel="shortcut icon" href="../../images/copylogo.png" type="image/x-icon" />
<link rel="stylesheet" href="../css/common.css">
<link rel="stylesheet" href="../css/main.css">
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript">
$(function(){
	$("#tname").bind({
		focus: function(){
			$("#msg").text("");
		},
		keydown:function(event) {
			if(event.which == 13){
				addNewsTypeInfo();
			}
		}
	})
	
	$.post("../../types", {op:"findAll"}, data=> {
		var str="";
		$.each(data, function(index, item){
			str +="<tr><td>" + item.tno + "</td><td>" + item.tname + "</td>";
			if( item.status == 0){
				str += "<td class='err'>[已下架]</td><td><a href='javascript:void(0)' class='correct' onclick='update(this, \"" + item.tno + "\", 1)'>[上架]</a></tr>";				
			} else{
				str += "<td class='correct'>[正常]</td><td><a href='javascript:void(0)' class='err' onclick='update(this, \"" + item.tno + "\", 0)'>[下架]</a></tr>";								
			}
		})
		$("#newstype_info").append($(str));
	},"json");
})


//添加新闻信息
function addNewsTypeInfo(){
	var tname=$.trim( $("#tname").val() );
	if (tname == "") {
		alert("请输入菜品类型名称...");
		return;
	}
	
	var tno = new Date().getTime();
	$.post("../../types", {op:"add", tno:tno, tname:tname}, data=>{
		data = parseInt($.trim(data));
		if(data == -1){
			$("#msg").text("您输入的信息不完整，请完善后提交...");
			return;
		}
		
		if( data>0){
			var str = "<tr><td>" + tno +"</td><td>" +tname + "</td><td class='correct'>[正常]</td>";
			str +="<td><a href='javascript:void(0)' class='err' onclick='update(this, \"" + tno + "\" , 0)'>[下架]</a></td></tr>";
			$("#newstype_info").append($(str));
			$("#tname").val("");
			return;
		}
		
		$("#msg").text("添加失败，请重试...");
	},"text")
}

function update(obj, tno, status){
	$.post("../../types", {op:"update", status:status, tno:tno}, data=>{
		data = parseInt($.trim(data));
		
		if(data == -1){
			$("#msg").text("信息不完整，请完善后提交...");
			return;
		}
		
		if(data >0){
			if(status == 1){
				$(obj).attr("onclick", "update(this, '" + tno +"',0)").attr("class","err").text("下架");
				$(obj).parent().parent().find("td").eq(2).removeClass("err").addClass("correct").text("正常");
			} else {
				$(obj).attr("onclick", "update(this, '" + tno +"',1)").attr("class","correct").text("上架");
				$(obj).parent().parent().find("td").eq(2).removeClass("correct").addClass("err").text("已下架");
			}
			return;
		}
		
		$("#msg").text("修改失败，请稍后重试...");
	},"text");
}
</script>
</head>
<body>
<div id="forms" class="mt10">
	<div class="box">
		<div class="box_border">
			<div class="box_center">
				菜品类型名称：<input type="text" id="tname" name="tname" class="input-text lh30" size="40"/>&nbsp;&nbsp;
				<input type="button" name="button" class="btn btn82 btn_save2" onclick="addNewsTypeInfo()" value="添加"/>&nbsp;&nbsp;
			    <span class="err" id="msg"></span>
			</div>
		</div>
	</div>
</div>

<div id="table" class="mt10">
	<div class="box span10 oh">
		<table width="100%" border="0" cellpadding="0" cellspacing="0" class="list_table">
			<thead>
				<tr>
					<th width="30%">菜品类型编号</th>
                   	<th>菜品类型名称</th>
                   	<th>状态</th>
                   	<th>操作</th>
                </tr>
             </thead>
             <tbody id="newstype_info" align="center">
             </tbody>
		</table>
	</div>
</div>
</body>
</html>